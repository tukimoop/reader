language: php

php:
  - 7.0
  - 7.1
  - 7.2

dist: trusty

services:
  - mysql

addons:
  mysql: "5.7"

cache:
  directories:
    - node_modules
    - vendor
    - $HOME/.composer/cache

script:
  - ./vendor/bin/phpunit --coverage-clover ./tests/Logs/clover.xml

before_script:
  - composer install --prefer-dist --no-interaction
  - mysql -e 'CREATE DATABASE IF NOT EXISTS lida;'
  - php artisan migrate:refresh --seed
  - php artisan serve &

env:
  global:
    - APP_NAME=Lida
    - APP_ENV=local
    - APP_KEY=base64:cWqL1uSNrHhQxQv02y/VPNP1omrzIOAB0Icdbub9dbo=
    - APP_DEBUG=true
    - APP_URL=http://127.0.0.1:8000

    - LOG_CHANNEL=stack
    - DB_CONNECTION=mysql
    - DB_HOST=127.0.0.1
    - DB_PORT=3306
    - DB_DATABASE=lida
    - DB_USERNAME=root
    - DB_PASSWORD=
    - DB_PREFIX=lr_

    - BROADCAST_DRIVER=log
    - CACHE_DRIVER=database
    - SESSION_DRIVER=database
    - SESSION_LIFETIME=200
    - QUEUE_DRIVER=database

    - REDIS_HOST=127.0.0.1
    - REDIS_PASSWORD=null
    - REDIS_PORT=6379

    - MAIL_DRIVER=ses
    - MAIL_HOST=smtp.mailtrap.io
    - MAIL_PORT=2525
    - MAIL_USERNAME=null
    - MAIL_PASSWORD=null
    - MAIL_ENCRYPTION=null

    - PUSHER_APP_ID=
    - PUSHER_APP_KEY=
    - PUSHER_APP_SECRET=
    - PUSHER_APP_CLUSTER=mt1

    - MIX_PUSHER_APP_KEY="${PUSHER_APP_KEY}"
    - MIX_PUSHER_APP_CLUSTER="${PUSHER_APP_CLUSTER}"